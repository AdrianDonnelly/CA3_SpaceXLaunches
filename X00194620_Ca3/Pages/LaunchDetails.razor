@page "/launch/{id}"
@using X00194620_Ca3.Services

<PageTitle>@(launch?.Name ?? "Launch Details")</PageTitle>

<MudContainer Class="mt-8">
    @if (loading){
        <MudProgressCircular Indeterminate="true"/>
    }
    else if (launch == null){
        <MudAlert Severity="Severity.Error">Launch not found</MudAlert>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/" Class="mt-4">
            Back to Home
        </MudButton>
    }
    else{
        <div class="d-flex align-center mb-4">
            <MudButton Variant="Variant.Text" StartIcon="@Icons.Material.Filled.ArrowBack" Href="/">
                Back to Launches
            </MudButton>
        </div>

        <div class="d-flex align-center mb-4">
            <MudText Typo="Typo.h3" Class="flex-grow-1">@launch.Name</MudText>
            <MudChip T="string" Color="@StatusColor" Variant="Variant.Filled" Size="Size.Large">
                @StatusText
            </MudChip>
        </div>

        <MudGrid>
            <MudItem xs="12" md="4">
                <MudPaper Class="pa-4 mb-4">
                    <MudText Typo="Typo.h6" Class="mb-3">Mission Patch</MudText>
                    @if (!string.IsNullOrWhiteSpace(launch.Links?.Patch?.Large)){
                        <MudImage Src="@launch.Links.Patch.Large"
                                  Alt="@($"{launch.Name} Patch")"
                                  Class="rounded-lg"
                                  Style="width: 100%; max-width: 300px; height: auto;"/>
                    }
                    else{
                        <MudText Color="Color.Secondary">No mission patch available</MudText>
                    }
                </MudPaper>

                <MudPaper Class="pa-4">
                    <MudText Typo="Typo.h6" Class="mb-3">Quick Info</MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem T="string" Icon="@Icons.Material.Filled.Event">
                            <MudText Typo="Typo.body2" Color="Color.Primary">Launch Date</MudText>
                            <MudText Typo="Typo.body1">
                                @(launch.DateUtc?.ToLocalTime().ToString("MMMM dd, yyyy") ?? "Unknown")
                            </MudText>
                            <MudText Typo="Typo.body2">
                                @(launch.DateUtc?.ToLocalTime().ToString("hh:mm tt") ?? "")
                            </MudText>
                        </MudListItem>

                        <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle">
                            <MudText Typo="Typo.body2" Color="Color.Primary">Status</MudText>
                            <MudText Typo="Typo.body1">@StatusText</MudText>
                        </MudListItem>

                        <MudListItem T="string" Icon="@Icons.Material.Filled.Tag">
                            <MudText Typo="Typo.body2" Color="Color.Primary">Launch ID</MudText>
                            <MudText Typo="Typo.body1" Style="font-family: monospace;">@launch.Id</MudText>
                        </MudListItem>
                    </MudList>
                </MudPaper>
            </MudItem>

            <MudItem xs="12" md="8">
                <MudPaper Class="pa-4 mb-4">
                    <MudText Typo="Typo.h6" Class="mb-3">Links & Resources</MudText>
                    <div class="d-flex flex-wrap" style="gap: 12px;">
                        @if (!string.IsNullOrWhiteSpace(launch.Links?.Webcast)){
                            <MudButton Variant="Variant.Filled"
                                       Color="Color.Error"
                                       StartIcon="@Icons.Material.Filled.PlayArrow"
                                       Href="@launch.Links.Webcast"
                                       Target="_blank">
                                Watch Webcast
                            </MudButton>
                        }

                        @if (!string.IsNullOrWhiteSpace(launch.Links?.Article)){
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Primary"
                                       StartIcon="@Icons.Material.Filled.Article"
                                       Href="@launch.Links.Article"
                                       Target="_blank">
                                Read Article
                            </MudButton>
                        }

                        @if (!string.IsNullOrWhiteSpace(launch.Links?.Wikipedia)){
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Primary"
                                       StartIcon="@Icons.Material.Filled.MenuBook"
                                       Href="@launch.Links.Wikipedia"
                                       Target="_blank">
                                Wikipedia
                            </MudButton>
                        }

                        @if (!string.IsNullOrWhiteSpace(launch.Links?.Presskit)){
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Primary"
                                       StartIcon="@Icons.Material.Filled.Description"
                                       Href="@launch.Links.Presskit"
                                       Target="_blank">
                                Press Kit
                            </MudButton>
                        }
                    </div>

                    @if (string.IsNullOrWhiteSpace(launch.Links?.Webcast) &&
                         string.IsNullOrWhiteSpace(launch.Links?.Article) &&
                         string.IsNullOrWhiteSpace(launch.Links?.Wikipedia) &&
                         string.IsNullOrWhiteSpace(launch.Links?.Presskit)){
                        <MudText Color="Color.Secondary" Class="mt-2">No external links available</MudText>
                    }
                </MudPaper>

                @if (launch.Links?.Flickr?.Original?.Any() == true){
                    <MudPaper ata-test-id="launch-card" Class="pa-4">
                        <MudText Typo="Typo.h6" Class="mb-3">Launch Photos</MudText>
                        <MudGrid Spacing="2">
                            @foreach (var imageUrl in launch.Links.Flickr.Original.Take(10)){
                                <MudItem xs="12" sm="6" md="4">
                                    <MudImage Src="@imageUrl"
                                              Alt="Launch photo"
                                              Class="rounded-lg"
                                              ObjectFit="ObjectFit.Cover"
                                              Style="width: 100%; height: 200px; cursor: pointer;"
                                              @onclick="() => OpenImageDialog(imageUrl)"/>
                                </MudItem>
                            }
                        </MudGrid>
                    </MudPaper>
                }
                else{
                    <MudPaper Class="pa-4">
                        <MudText Typo="Typo.h6" Class="mb-3">Launch Photos</MudText>
                        <MudText Color="Color.Secondary">No photos available for this launch</MudText>
                    </MudPaper>
                }
            </MudItem>
        </MudGrid>
    }
</MudContainer>

<MudDialog @bind-IsVisible="imageDialogOpen" Options="dialogOptions">
    <TitleContent>
        <MudText Typo="Typo.h6">Launch Photo</MudText>
    </TitleContent>
    <DialogContent>
        <MudImage Src="@selectedImageUrl" Alt="Launch photo" Style="width: 100%; height: auto;"/>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="CloseImageDialog">Close</MudButton>
    </DialogActions>
</MudDialog>

